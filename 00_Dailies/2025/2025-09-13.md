(torch) sczd425@ln01:~/run/xinby/vcc_local$ python stage2_official_baseline_generation.py 
ğŸ¯ é˜¶æ®µ2C: cell-evalå®˜æ–¹baselineç”Ÿæˆ
============================================================
ğŸ¯ ä½¿ç”¨cell-evalå®˜æ–¹æ–¹æ³•ç”Ÿæˆbaseline
============================================================
ğŸ“‚ åŠ è½½è®­ç»ƒæ•°æ®: splits/train_fixed.h5ad
è®­ç»ƒæ•°æ®å½¢çŠ¶: (11326, 18080)
æ‰°åŠ¨æ¡ä»¶: target_gene
non-targeting    7483
SDC1              170
HMGCR             166
NDUFB4            166
UQCRQ             166
DPH2              164
WAC               162
ATP6V0B           147
NISCH             144
METTL3            138
CHMP3             130
DNAJA3            127
RNF20             124
METTL17           122
METTL14           121
SSBP1             119
SMAGP             117
COX6C             117
SLC25A3           114
LRPPRC            110
STRAP             106
RRM1              103
HTATSF1            96
UQCRB              96
KIF20A             96
TFAM               82
SUPV3L1            80
SUPT4H1            74
MBTPS1             68
MAU2               66
HDAC3              60
ATP6V0C            53
PPP2R3C            52
MAT2A              52
EWSR1              48
EIF4B              41
SMARCE1            31
FDPS               10
SEC62               5
Name: count, dtype: int64
éªŒè¯æ•°æ®å½¢çŠ¶: (6115, 18080)

ğŸ“Š éªŒè¯é›†ç»†èƒæ•°é‡åˆ†å¸ƒ:
  ARPC2: 200
  DHX36: 200
  C1QBP: 200
  JAZF1: 200
  HIRA: 200
  MED1: 200
  EIF3H: 200
  TMSB10: 200
  MED12: 200
  OXA1L: 200
  NDUFB6: 190
  USF2: 185
  SMARCB1: 182
  MAX: 180
  DNMT1: 170

ğŸ“‹ Baselineç»†èƒæ•°é‡é…ç½®:
   target_gene  n_cells
0        ARPC2      200
1        DHX36      200
2        C1QBP      200
3        JAZF1      200
4         HIRA      200
5         MED1      200
6        EIF3H      200
7       TMSB10      200
8        MED12      200
9        OXA1L      200
10      NDUFB6      190
11        USF2      185
12     SMARCB1      182
13         MAX      180
14       DNMT1      170

ğŸ”§ è°ƒç”¨cell-evalå®˜æ–¹baselineç”Ÿæˆæ–¹æ³•...
INFO:cell_eval._evaluator:Input is found to be log-normalized already - skipping transformation.
INFO:cell_eval._baseline:Filtering out counts from non-targeting
INFO:cell_eval._baseline:Building perturbation-level means
INFO:cell_eval._baseline:Calculating mean of perturbation-level means
INFO:cell_eval._baseline:Assembling baseline adata from perturbation mean
INFO:cell_eval._baseline:Concatenating baseline adata with controls from original adata
INFO:cell_eval._baseline:Saving baseline data to predictions/official_baseline_pred_val.h5ad
... storing 'target_gene' as categorical
âœ… cell-evalå®˜æ–¹baselineç”ŸæˆæˆåŠŸ
Baselineæ•°æ®å½¢çŠ¶: (10390, 18080)
æ‰°åŠ¨æ¡ä»¶: target_gene
non-targeting    7483
ARPC2             200
DHX36             200
C1QBP             200
JAZF1             200
HIRA              200
MED1              200
EIF3H             200
TMSB10            200
MED12             200
OXA1L             200
NDUFB6            190
USF2              185
SMARCB1           182
MAX               180
DNMT1             170
Name: count, dtype: int64

âœ… å®˜æ–¹baselineç”Ÿæˆå®Œæˆ!
ä¿å­˜è·¯å¾„: predictions/official_baseline_pred_val.h5ad

ğŸ” å¯¹æ¯”å®˜æ–¹baselineä¸è‡ªç ”baseline...

ğŸ“Š Baselineå¯¹æ¯”:
å®˜æ–¹baseline: (10390, 18080)
è‡ªç ”baseline: (6115, 18080)

ğŸ¯ ç›®æ ‡åŸºå› åˆ†å¸ƒå¯¹æ¯”:
ç›®æ ‡           å®˜æ–¹       è‡ªç ”       å·®å¼‚      
----------------------------------------
ARPC2        200      200      0       
C1QBP        200      200      0       
DHX36        200      200      0       
DNMT1        170      170      0       
EIF3H        200      200      0       
HIRA         200      200      0       
JAZF1        200      200      0       
MAX          180      180      0       
MED1         200      200      0       
MED12        200      200      0       
NDUFB6       190      190      0       
OXA1L        200      200      0       
SMARCB1      182      182      0       
TMSB10       200      200      0       
USF2         185      185      0       
non-targeting 7483     3208     4275    

ğŸ“ˆ è¡¨è¾¾å€¼å·®å¼‚åˆ†æ:
å…±åŒç›®æ ‡æ•°é‡: 16
  ARPC2: MAEå·®å¼‚ = 0.002639
  C1QBP: MAEå·®å¼‚ = 0.002639
  DHX36: MAEå·®å¼‚ = 0.002639

ğŸ¯ ä¸‹ä¸€æ­¥:
1. ä½¿ç”¨å®˜æ–¹baselineé‡æ–°è¿è¡Œè¯„åˆ†
2. æ£€æŸ¥DESæ˜¯å¦ä»ç„¶è™šé«˜1.0
3. å¯¹æ¯”å®˜æ–¹baselineä¸è‡ªç ”baselineçš„è¯„åˆ†å·®å¼‚

ğŸ“ è¿è¡Œå®˜æ–¹baselineè¯„åˆ†:
python stage2_official_celleval_scoring.py
(éœ€è¦ä¿®æ”¹è¾“å…¥æ–‡ä»¶è·¯å¾„ä¸ºå®˜æ–¹baseline)
(torch) sczd425@ln01:~/run/xinby/vcc_local$ python stage2_official_celleval_scoring.py
ğŸ¯ é˜¶æ®µ2B: cell-evalå®˜æ–¹VCCè¯„åˆ†
============================================================
âœ… ä½¿ç”¨å®˜æ–¹baseline: predictions/official_baseline_pred_val.h5ad
ğŸ”„ å‡†å¤‡cell-evalæ ¼å¼æ•°æ®...
é¢„æµ‹æ•°æ®: (10390, 18080)
çœŸå®æ•°æ®: (6115, 18080)
é¢„æµ‹æ•°æ®æ‰°åŠ¨æ¡ä»¶: ['ARPC2', 'DHX36', 'C1QBP', 'JAZF1', 'HIRA', ..., 'USF2', 'SMARCB1', 'MAX', 'DNMT1', 'non-targeting']
Length: 16
Categories (16, object): ['ARPC2', 'C1QBP', 'DHX36', 'DNMT1', ..., 'SMARCB1', 'TMSB10', 'USF2',
                          'non-targeting']
çœŸå®æ•°æ®æ‰°åŠ¨æ¡ä»¶: ['MED12', 'EIF3H', 'OXA1L', 'HIRA', 'DHX36', ..., 'USF2', 'SMARCB1', 'MAX', 'DNMT1', 'non-targeting']
Length: 16
Categories (16, object): ['ARPC2', 'C1QBP', 'DHX36', 'DNMT1', ..., 'SMARCB1', 'TMSB10', 'USF2',
                          'non-targeting']
âœ… æ•°æ®æ ¼å¼éªŒè¯é€šè¿‡

ğŸ¯ è¿è¡Œcell-evalå®˜æ–¹VCCè¯„åˆ†...
WARNING:cell_eval._evaluator:Output directory reports/celleval_official_output already exists, potential overwrite occurring
INFO:cell_eval._evaluator:Input is found to be log-normalized already - skipping transformation.
INFO:cell_eval._evaluator:Input is found to be log-normalized already - skipping transformation.
INFO:cell_eval._evaluator:Computing DE for real data
INFO:pdex._single_cell:Precomputing masks for each target gene
Identifying target masks: 100%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ| 16/16 [00:00<00:00, 13709.68it/s]
INFO:pdex._single_cell:Precomputing variable indices for each feature
Identifying variable indices: 100%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ| 18080/18080 [00:00<00:00, 3905294.90it/s]
INFO:pdex._single_cell:Creating shared memory memory matrix for parallel computing
INFO:pdex._single_cell:Creating generator of all combinations: N=289280
INFO:pdex._single_cell:Creating generator of all batches: N=2893
INFO:pdex._single_cell:Initializing parallel processing pool
INFO:pdex._single_cell:Processing batches
Processing batches: 100%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ| 2893/2893 [00:09<00:00, 317.33it/s]
INFO:pdex._single_cell:Flattening results
INFO:pdex._single_cell:Closing shared memory pool
INFO:cell_eval._evaluator:Writing real DE results to: vcc_baseline_real_de.csv
INFO:cell_eval._evaluator:Computing DE for pred data
INFO:pdex._single_cell:Precomputing masks for each target gene
Identifying target masks: 100%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ| 16/16 [00:00<00:00, 10372.31it/s]
INFO:pdex._single_cell:Precomputing variable indices for each feature
Identifying variable indices: 100%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ| 18080/18080 [00:00<00:00, 3056304.06it/s]
INFO:pdex._single_cell:Creating shared memory memory matrix for parallel computing
INFO:pdex._single_cell:Creating generator of all combinations: N=289280
INFO:pdex._single_cell:Creating generator of all batches: N=2893
INFO:pdex._single_cell:Initializing parallel processing pool
INFO:pdex._single_cell:Processing batches
Processing batches: 100%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ| 2893/2893 [00:13<00:00, 209.96it/s]
INFO:pdex._single_cell:Flattening results
INFO:pdex._single_cell:Closing shared memory pool
INFO:cell_eval._evaluator:Writing pred DE results to: vcc_baseline_pred_de.csv
âœ… MetricsEvaluatoråˆå§‹åŒ–æˆåŠŸ
ğŸ”„ è®¡ç®—æ­£ç¡®çš„VCCæŒ‡æ ‡: mae, discrimination_score_l1, de_sig_genes_recall...
INFO:cell_eval._pipeline._runner:Computing metric 'de_sig_genes_recall'
INFO:cell_eval._pipeline._runner:Computing metric 'mae'
INFO:cell_eval._types._anndata:Building pseudobulk embeddings for real anndata on: .X
INFO:cell_eval._types._anndata:Building pseudobulk embeddings for predicted anndata on: .X
Iterating over perturbations...: 100%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ| 15/15 [00:00<00:00, 1145.78it/s]
INFO:cell_eval._pipeline._runner:Computing metric 'discrimination_score_l1'
Iterating over perturbations...: 100%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ| 15/15 [00:00<00:00, 14125.41it/s]
Iterating over perturbations...: 100%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ| 15/15 [00:00<00:00, 19741.00it/s]
âœ… cell-eval VCCè¯„åˆ†å®Œæˆ

ğŸ“Š è§£æcell-evalå®˜æ–¹è¯„åˆ†ç»“æœ...
results_dfç±»å‹: <class 'polars.dataframe.frame.DataFrame'>
agg_results_dfç±»å‹: <class 'polars.dataframe.frame.DataFrame'>
èšåˆç»“æœåˆ—å: ['statistic', 'de_sig_genes_recall', 'mae', 'discrimination_score_l1']
èšåˆç»“æœå½¢çŠ¶: (9, 4)
è½¬æ¢ä¸ºpandasåçš„å†…å®¹:
    statistic  de_sig_genes_recall        mae  discrimination_score_l1
0       count            15.000000  15.000000                15.000000
1  null_count             0.000000   0.000000                 0.000000
2        mean             0.814566   0.021610                 0.533333
3         std             0.039334   0.010965                 0.298142
4         min             0.746032   0.013834                 0.066667
5         25%             0.797619   0.014389                 0.333333
6         50%             0.821094   0.017133                 0.533333
7         75%             0.838554   0.022500                 0.800000
8         max             0.875000   0.049048                 1.000000
æå–çš„meanè¡Œæ•°æ®: {'de_sig_genes_recall': 0.8145663243956018, 'mae': 0.021609651297330855, 'discrimination_score_l1': 0.5333333333333333}
âœ… æˆåŠŸæå–å®˜æ–¹è¯„åˆ†:
  mae: 0.0216
  pds: 0.5333
  des: 0.8146

ğŸ’¾ ä¿å­˜å®˜æ–¹è¯„åˆ†ç»“æœ...
âœ… JSONç»“æœ: reports/stage2_official_celleval_scores.json
âœ… æ–‡æœ¬æŠ¥å‘Š: reports/stage2_official_celleval_report.txt

ğŸ” å¯¹æ¯”å®˜æ–¹è¯„åˆ† vs è‡ªç ”è¯„åˆ†...

ğŸ“Š è¯„åˆ†å¯¹æ¯”:
============================================================
æŒ‡æ ‡                   å®˜æ–¹è¯„åˆ†         è‡ªç ”è¯„åˆ†         å·®å¼‚          
============================================================
MAE                  0.0216       0.0214       0.0002      
PDS                  0.5333       0.5000       0.0333      
============================================================

ğŸ‰ é˜¶æ®µ2Bå®˜æ–¹è¯„åˆ†å®Œæˆ!
âœ… å®˜æ–¹è¯„åˆ†ç»“æœ: reports/stage2_official_celleval_scores.json
âœ… cell-evalè¾“å‡º: reports/celleval_official_output

ğŸ“Š å®˜æ–¹VCCè¯„åˆ†æ€»ç»“:
  mae: 0.0216
  pds: 0.5333
  des: 0.8146

ğŸ¯ é‡è¦å‘ç°:
1. VCC profileä¸­çš„overlap_at_NæŒ‡æ ‡åœ¨registryä¸­ä¸å­˜åœ¨
2. æ­£ç¡®çš„VCCæŒ‡æ ‡æ˜¯: mae, discrimination_score_l1, de_sig_genes_recall
3. æœ¬è„šæœ¬ä½¿ç”¨äº†æ­£ç¡®çš„å®˜æ–¹æŒ‡æ ‡å®ç°