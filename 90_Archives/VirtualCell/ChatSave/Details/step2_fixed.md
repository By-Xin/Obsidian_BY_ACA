(torch) sczd425@ln01:~/run/xinby/vcc_local$ python step2_train_val_split_fixed.py 
ğŸš€ Step 2 ä¿®å¤ç‰ˆ: æ„å»ºè®­ç»ƒ/éªŒè¯æ•°æ®æ‹†åˆ†ï¼ˆæŒ‰åŸºå› æ‹†åˆ†ï¼Œæ— æ•°æ®æ³„æ¼ï¼‰
éšæœºç§å­: 2025
ğŸ“‚ åŠ è½½æ•°æ®: data_raw/k562_standardized.h5ad
æ•°æ®å½¢çŠ¶: (18465, 18080)
ğŸ§¬ åŠ è½½å®˜æ–¹åŸºå› é¡ºåº...
âœ… æˆåŠŸåŠ è½½18080ä¸ªåŸºå› 
å‰10ä¸ªåŸºå› : ['SAMD11', 'NOC2L', 'KLHL17', 'PLEKHN1', 'PERM1', 'HES4', 'ISG15', 'AGRN', 'RNF223', 'C1orf159']

ğŸ” å®Œæ•´éªŒè¯åŸºå› é¡ºåºä¸€è‡´æ€§...
âœ… åŸºå› é¡ºåºå®Œå…¨ä¸€è‡´
ğŸ” åˆ†ææ‰°åŠ¨åˆ†å¸ƒï¼ˆæŒ‰åŸºå› æ‹†åˆ†æ¨¡å¼ï¼‰...
æ€»æ‰°åŠ¨ç±»å‹æ•°: 54
æ€»ç»†èƒæ•°: 18465
æ§åˆ¶ç»†èƒæ•°: 10691
æ‰°åŠ¨ç±»å‹æ•°: 53

å¯ç”¨äºéªŒè¯çš„æ‰°åŠ¨ (>=150ç»†èƒ):
æ•°é‡: 21
å‰10ä¸ªæ‰°åŠ¨:
target_gene
MED12     573
EIF3H     369
OXA1L     344
HIRA      341
DHX36     269
MED1      254
TMSB10    228
ARPC2     227
C1QBP     210
JAZF1     209

âœ… é€‰å®šéªŒè¯æ‰°åŠ¨: 15ä¸ª
  1. MED12: 573ç»†èƒ
  2. EIF3H: 369ç»†èƒ
  3. OXA1L: 344ç»†èƒ
  4. HIRA: 341ç»†èƒ
  5. DHX36: 269ç»†èƒ
  6. MED1: 254ç»†èƒ
  7. TMSB10: 228ç»†èƒ
  8. ARPC2: 227ç»†èƒ
  9. C1QBP: 210ç»†èƒ
  10. JAZF1: 209ç»†èƒ
  11. NDUFB6: 190ç»†èƒ
  12. USF2: 185ç»†èƒ
  13. SMARCB1: 182ç»†èƒ
  14. MAX: 180ç»†èƒ
  15. DNMT1: 170ç»†èƒ

è®­ç»ƒæ‰°åŠ¨: 38ä¸ª
éªŒè¯æ‰°åŠ¨: 15ä¸ª
æ§åˆ¶ç»†èƒ: è®­ç»ƒå’ŒéªŒè¯é›†éƒ½åŒ…å«

ğŸ”„ æŒ‰æ‰°åŠ¨åŸºå› è¿›è¡Œæ‹†åˆ†ï¼ˆæ— æ³„æ¼æ¨¡å¼ï¼‰...
æ§åˆ¶ç»†èƒæ‹†åˆ†: 7483è®­ç»ƒ + 3208éªŒè¯

å¤„ç†éªŒè¯æ‰°åŠ¨ï¼ˆæ¯ä¸ªæ‰°åŠ¨æœ€å¤š200ä¸ªç»†èƒï¼‰:
  MED12: 573 -> 200ç»†èƒ
  EIF3H: 369 -> 200ç»†èƒ
  OXA1L: 344 -> 200ç»†èƒ
  HIRA: 341 -> 200ç»†èƒ
  DHX36: 269 -> 200ç»†èƒ
  MED1: 254 -> 200ç»†èƒ
  TMSB10: 228 -> 200ç»†èƒ
  ARPC2: 227 -> 200ç»†èƒ
  C1QBP: 210 -> 200ç»†èƒ
  JAZF1: 209 -> 200ç»†èƒ
  NDUFB6: 190ç»†èƒï¼ˆæ— éœ€é™åˆ¶ï¼‰
  USF2: 185ç»†èƒï¼ˆæ— éœ€é™åˆ¶ï¼‰
  SMARCB1: 182ç»†èƒï¼ˆæ— éœ€é™åˆ¶ï¼‰
  MAX: 180ç»†èƒï¼ˆæ— éœ€é™åˆ¶ï¼‰
  DNMT1: 170ç»†èƒï¼ˆæ— éœ€é™åˆ¶ï¼‰

ğŸ“Š æ‹†åˆ†ç»Ÿè®¡:
è®­ç»ƒç»†èƒæ•°: 11326
  - æ‰°åŠ¨ç»†èƒ: 3843
  - æ§åˆ¶ç»†èƒ: 7483
  - æ‰°åŠ¨ç±»å‹: 38 (ä¸å«æ§åˆ¶)
éªŒè¯ç»†èƒæ•°: 6115
  - æ‰°åŠ¨ç»†èƒ: 2907
  - æ§åˆ¶ç»†èƒ: 3208
  - æ‰°åŠ¨ç±»å‹: 15 (ä¸å«æ§åˆ¶)

ğŸ”’ æ•°æ®æ³„æ¼æ£€æŸ¥:
âœ… æ— æ•°æ®æ³„æ¼ï¼ŒéªŒè¯æ‰°åŠ¨åœ¨è®­ç»ƒé›†ä¸­å®Œå…¨ä¸å­˜åœ¨

ğŸ“ åˆ›å»ºæ‹†åˆ†æ•°æ®é›†...
è®­ç»ƒé›†: (11326, 18080)
è®­ç»ƒé›†æ‰°åŠ¨åˆ†å¸ƒ (å‰10ä¸ª):
target_gene
non-targeting    7483
SDC1              170
HMGCR             166
NDUFB4            166
UQCRQ             166
DPH2              164
WAC               162
ATP6V0B           147
NISCH             144
METTL3            138
Name: count, dtype: int64

éªŒè¯é›†: (6115, 18080)
éªŒè¯é›†æ‰°åŠ¨åˆ†å¸ƒ:
target_gene
non-targeting    3208
ARPC2             200
DHX36             200
C1QBP             200
JAZF1             200
HIRA              200
MED1              200
EIF3H             200
TMSB10            200
MED12             200
OXA1L             200
NDUFB6            190
USF2              185
SMARCB1           182
MAX               180
DNMT1             170
Name: count, dtype: int64

âœ… éªŒè¯åŸºå› æ‹†åˆ†ç»“æœ...
==================================================
âœ“ åŸºå› æ•°é‡ä¸€è‡´: è®­ç»ƒ:18080, éªŒè¯:18080
âœ“ åŸºå› é¡ºåºä¸€è‡´: ä¸€è‡´
âœ“ æ•°æ®ç±»å‹: float32, float32
âœ“ éªŒè¯æ‰°åŠ¨åŒ¹é…: æœŸæœ›15, å®é™…15
âœ“ æ— æ‰°åŠ¨åŸºå› æ³„æ¼: æ— æ³„æ¼
âœ“ è®­ç»ƒé›†æ§åˆ¶ç»†èƒ: 7483ä¸ª
âœ“ éªŒè¯é›†æ§åˆ¶ç»†èƒ: 3208ä¸ª
âœ“ ç»†èƒç´¢å¼•æ— é‡å : æ— é‡å 

æ€»ä½“ç»“æœ: âœ… é€šè¿‡

ğŸ’¾ ä¿å­˜ä¿®å¤åçš„æ‹†åˆ†æ•°æ®...
âœ… è®­ç»ƒé›†: splits/train_fixed.h5ad
âœ… éªŒè¯é›†: splits/val_fixed.h5ad

ğŸ’¾ ä¿å­˜æ‹†åˆ†ä¿¡æ¯...
âœ… éªŒè¯åŸºå› åˆ—è¡¨: splits/validation_genes_fixed.csv
âœ… æ‹†åˆ†ç»Ÿè®¡: splits/split_statistics_fixed.csv
âœ… è¯¦ç»†æŠ¥å‘Š: reports/step2_split_report_fixed.txt

ğŸ‰ Step 2 ä¿®å¤å®Œæˆï¼
ğŸ”’ å…³é”®ä¿®å¤: éªŒè¯æ‰°åŠ¨åœ¨è®­ç»ƒé›†ä¸­å®Œå…¨ä¸å­˜åœ¨ï¼Œæ— æ•°æ®æ³„æ¼
å¯ä»¥è¿›è¡Œä¸‹ä¸€æ­¥ï¼šç”ŸæˆéªŒè¯çœŸå€¼

Step 2 Train-Val Split Report (FIXED - No Data Leakage)
============================================================
Random seed: 2025
Split date: 2025-09-12 21:53:34.109314
CRITICAL FIX: No perturbation gene leakage between train/val

Training Set:
  Cells: 11326
  Genes: 18080
  Perturbations: 38 (ä¸å«æ§åˆ¶)
  Control cells: 7483
  Training perturbations: ['ATP6V0B', 'ATP6V0C', 'CHMP3', 'COX6C', 'DNAJA3', 'DPH2', 'EIF4B', 'EWSR1', 'FDPS', 'HDAC3', 'HMGCR', 'HTATSF1', 'KIF20A', 'LRPPRC', 'MAT2A', 'MAU2', 'MBTPS1', 'METTL14', 'METTL17', 'METTL3', 'NDUFB4', 'NISCH', 'PPP2R3C', 'RNF20', 'RRM1', 'SDC1', 'SEC62', 'SLC25A3', 'SMAGP', 'SMARCE1', 'SSBP1', 'STRAP', 'SUPT4H1', 'SUPV3L1', 'TFAM', 'UQCRB', 'UQCRQ', 'WAC']

Validation Set:
  Cells: 6115
  Genes: 18080
  Perturbations: 15 (ä¸å«æ§åˆ¶)
  Control cells: 3208

Validation Perturbations (å®Œå…¨ä¸åœ¨è®­ç»ƒé›†ä¸­):
  ARPC2: 200 cells
  DHX36: 200 cells
  C1QBP: 200 cells
  JAZF1: 200 cells
  HIRA: 200 cells
  MED1: 200 cells
  EIF3H: 200 cells
  TMSB10: 200 cells
  MED12: 200 cells
  OXA1L: 200 cells
  NDUFB6: 190 cells
  USF2: 185 cells
  SMARCB1: 182 cells
  MAX: 180 cells
  DNMT1: 170 cells

ğŸ”’ Data Leakage Check: PASSED
- éªŒè¯æ‰°åŠ¨åœ¨è®­ç»ƒé›†ä¸­å®Œå…¨ä¸å­˜åœ¨
- ä»…æ§åˆ¶ç»†èƒ(non-targeting)åœ¨ä¸¤ä¸ªé›†åˆä¸­å…±å­˜
